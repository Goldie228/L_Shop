/**
 * Конфигурация Jest для проекта L_Shop
 * 
 * Jest - фреймворк для тестирования JavaScript/TypeScript.
 * Поддерживает модульное тестирование, моки и отчёты о покрытии.
 * 
 * Документация: https://jestjs.io/docs/configuration
 * 
 * Использование:
 * - npm test - запустить все тесты
 * - npm run test:watch - режим слежения
 * - npm run test:coverage - отчёт о покрытии
 */
module.exports = {
  // ============================================
  // Пресет
  // ============================================
  // Используем ts-jest для поддержки TypeScript
  // Автоматически настраивает трансформацию .ts файлов
  preset: 'ts-jest',

  // ============================================
  // Окружение тестирования
  // ============================================
  // Node.js окружение (без браузера)
  // Причина: backend не требует DOM
  testEnvironment: 'node',

  // ============================================
  // Корневые директории для поиска тестов
  // ============================================
  // Ищем тесты только в src/backend
  roots: ['<rootDir>/src/backend'],

  // ============================================
  // Паттерны для поиска тестовых файлов
  // ============================================
  // Ищем файлы с расширением .test.ts в папках __tests__
  testMatch: ['**/__tests__/**/*.test.ts'],

  // ============================================
  // Настройки покрытия кода (coverage)
  // ============================================
  // Файлы, для которых собираем покрытие
  collectCoverageFrom: [
    // Все TypeScript файлы в src/backend
    'src/backend/**/*.ts',
    // Исключаем точку входа приложения
    '!src/backend/app.ts',
    // Исключаем файлы деклараций типов
    '!src/backend/**/*.d.ts',
    // Исключаем тестовые файлы
    '!src/backend/**/__tests__/**',
    // Исключаем скрипты
    '!src/backend/scripts/**',
  ],

  // ============================================
  // Директория для отчётов покрытия
  // ============================================
  // Отчёты будут в папке coverage/
  coverageDirectory: 'coverage',

  // ============================================
  // Форматы отчётов покрытия
  // ============================================
  coverageReporters: ['text', 'lcov', 'html'],

  // ============================================
  // Пороги покрытия (опционально)
  // ============================================
  // Минимальный процент покрытия для успешного прохождения тестов
  // coverageThreshold: {
  //   global: {
  //     branches: 80,
  //     functions: 80,
  //     lines: 80,
  //     statements: 80,
  //   },
  // },

  // ============================================
  // Подробный вывод
  // ============================================
  // Показывать о каждом тесте
  verbose: true,

  // ============================================
  // Таймаут тестов
  // ============================================
  // Максимальное время выполнения одного теста (10 секунд)
  testTimeout: 10000,

  // ============================================
  // Модули
  // ============================================
  // Очищать моки между тестами автоматически
  clearMocks: true,

  // Сбрасывать моки между тестами
  resetMocks: true,

  // Восстанавливать моки после каждого теста
  restoreMocks: true,
};
